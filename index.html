<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CoffeeTeam Pro</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="css/styles.css">
  <meta name="theme-color" content="#d97706">
</head>
<body>
  <!-- Welcome Screen -->
  <div id="welcome" class="screen active">
    <h1>专  -CoffeeTeam</h1>
    <p>专 转驻拽 转</p>
    <div class="role-buttons">
      <button class="role-btn" data-role="cashier">拽驻</button>
      <button class="role-btn" data-role="barista">专住</button>
      <button class="role-btn" data-role="manager"></button>
    </div>
  </div>

  <!-- Auth Modal for Manager -->
  <div id="auth-modal" class="modal hidden">
    <div class="modal-box">
      <h2>转 </h2>
      <input type="password" id="password-input" placeholder="拽 住住" aria-label="住住">
      <button id="auth-btn">转专</button>
    </div>
  </div>

  <!-- Name Modal -->
  <div id="name-modal" class="modal hidden">
    <div class="modal-box">
      <h2> 砖?</h2>
      <input type="text" id="name-input" placeholder="拽 砖" aria-label="砖 砖转砖">
      <button id="name-btn">砖</button>
    </div>
  </div>

  <!-- Connection Modal (QR for P2P) -->
  <div id="connection-modal" class="modal hidden">
    <div class="modal-box">
      <h2>专 爪转</h2>
      <p id="connection-text">住专拽 转 -QR 拽  转专</p>
      <div id="qr-code"></div>
      <button id="connect-btn">专 砖</button>
    </div>
  </div>

  <!-- Main App Screen -->
  <div id="app" class="screen hidden">
    <header class="header">
      <div class="user-info">
        <span id="user-name"></span>
        <span id="role-badge"></span>
      </div>
      <div class="status">
        <span id="connection-status">专</span>
      </div>
      <button id="settings-btn" aria-label="专转">锔</button>
      <button id="logout-btn" aria-label="爪"></button>
    </header>

    <!-- Cashier Interface -->
    <div id="cashier-interface" class="role-interface hidden">
      <div class="voice-box">
        <button id="mic-btn" class="mic-btn" aria-label="驻注 拽专驻"></button>
        <div id="listening-indicator" class="hidden">...</div>
        <div id="parsed-order" class="parsed hidden"></div>
        <button id="send-order-btn" class="send-btn hidden" disabled>砖 </button>
      </div>
      <div id="recent-orders" class="orders-grid">
        <h3>转 专转</h3>
      </div>
      <textarea id="manual-input" placeholder="拽  转 (驻爪)" aria-label="拽 转"></textarea>
    </div>

    <!-- Barista Interface -->
    <div id="barista-interface" class="role-interface hidden">
      <div id="order-queue" class="orders-grid">
        <h3>转专 转</h3>
      </div>
    </div>

    <!-- Manager Interface -->
    <div id="manager-interface" class="role-interface hidden">
      <div class="stats-grid">
        <div class="stat-card">
          <h4>转 </h4>
          <span id="today-orders">0</span>
        </div>
        <div class="stat-card">
          <h4> 爪注</h4>
          <span id="avg-time">0 拽'</span>
        </div>
        <div class="stat-card">
          <h4>爪转 专</h4>
          <span id="connected-team">0</span>
        </div>
        <div class="stat-card">
          <h4>注转</h4>
          <span id="efficiency">100%</span>
        </div>
      </div>
      <div id="team-list">
        <h3>爪转</h3>
      </div>
      <div id="order-history" class="orders-grid">
        <h3>住专 </h3>
        <button id="export-csv">爪 CSV</button>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toast-container"></div>

  <!-- Install Prompt (PWA) -->
  <div id="install-prompt" class="hidden">
    <p>转拽 转 CoffeeTeam 注 砖专!</p>
    <button id="install-btn">转拽</button>
  </div>

  <!-- Scripts (load order matters) -->

  <!-- 注 砖专 砖 qrcode.js -CDN (注, 拽,  拽抓 拽) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <script src="js/storage.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/voice.js"></script>
  <script src="js/p2p.js"></script>
  <script src="js/app.js"></script>

  <!-- 驻拽爪转 QR 转转 (砖转砖转 住驻专 砖注 注) -->
  <script>
    function generateQR(text) {
      const div = document.getElementById('qr-code');
      if (!div) return;
      div.innerHTML = ''; // 拽 转 砖
      new QRCode(div, {
        text: text,
        width: 256,
        height: 256,
        colorDark: "#000000",
        colorLight: "#ffffff",
        correctLevel: QRCode.CorrectLevel.H // 注转  转专 住专拽
      });
    }

    // 转 转 专  (爪 注 "专 砖")
    document.addEventListener('click', (e) => {
      if (e.target.id === 'connect-btn') {
        const input = prompt('拽  转 转 -QR (拽住 专 住住64):');
        if (input && P2P.peers.size === 0) {
          if (App.state.role === 'cashier') {
            P2P.handleAnswer(input);
          } else {
            P2P.handleOffer(input);
          }
        }
      }
    });
  </script>
</body>
</html>